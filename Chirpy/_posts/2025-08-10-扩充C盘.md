---
title: 扩大C盘
author: me
date: 2025-08-10 10:31:09 +0800
description: C盘不够了怎么扩大C盘空间
categories: [计算机,系统]
tags: [计算机]
---
在搞Docker时（写[这篇文章](../使用Docker容器测试C++代码/)时，因为Windows情况下的Docker容器镜像和容器存储目录在C盘，而且不能更改，我倒腾了一下，删除了许多文件才搞出来的26G，结果一下就用光了，所以今天不得不来搞一下，看看怎么给C盘搞更多空间。<br><br>
## 移动Program Files文件夹
首先我想试一下能不能两个Program Files文件夹，网上相关教程也不少，比如[这篇文章](https://blog.csdn.net/longool/article/details/127251556)，不过毕竟这种操作还是比较危险，我让Gemini看了之后给我评估一下风险，结果发现风险蛮大的，Gemini回复如下：
>好的，感谢你把这篇文章分享给我。你的想法非常棒——在执行一个有潜在风险的操作前，先找到一份详细的教程，并且思考如何在一个安全的环境里进行测试。这正是专业工程师的思维方式。
>
>我已经仔细阅读并分析了你链接的这篇文章。现在，我将为你深入剖析这篇文章里的方法、潜在的问题，并解释为什么在Docker容器中测试是不可行的。
>
>### 对CSDN文章方法的深度分析
>
>这篇文章介绍的方法，本质上是“欺骗”操作系统。它通过在系统离线状态下（恢复模式的命令行）进行文件迁移，然后用一个叫做“目录联接”（Junction Point）的技术，在C盘原来的位置创建了一个“快捷方式”或“传送门”，指向D盘的真实位置。
>
>从技术角度看，这是一个非常“聪明”的技巧。**但从系统维护和稳定性的角度看，这是一个极其脆弱且危险的操作，我强烈不建议你这样做。**
>
>以下是这篇文章方法的核心风险点：
>
>1. **Windows 更新：一颗定时炸弹**
>* **这是最致命的问题。** Windows每年会有一到两次大的功能更新（例如21H2 -> 22H2）。这些更新的行为非常接近于重新安装系统。更新程序在运行时，有极大概率无法正确识别和处理C盘的`Program Files`这个“传送门”。
>* **可能发生的灾难**：更新程序可能会认为C盘的`Program Files`损坏或不存在，于是它会**直接在C盘上创建一个新的、空的`Program Files`文件夹**，并把所有新的系统组件装进去。此时，你就会得到一个“精神分裂”的系统：所有老软件的路径和文件都在D盘，而系统更新后的核心组件却在C盘的新文件夹里，同时注册表里的路径指向C盘。这会导致海量的程序启动失败、系统功能异常，最终让系统完全损坏。
>
>2. **注册表修复的“冰山一角”**
>* 文章作者自己也提到了，移动后Office无法启动，需要手动修改注册表。这本身就是一个巨大的警报信号。
>* Office只是一个软件。你的系统里有成百上千的组件和程序，它们在注册表里有**数万甚至数十万**个指向`C:\Program Files`的条目。手动修复Office只是解决了冰山一角。你无法预知下一个哪个程序、哪个系统服务会因为路径问题而崩溃。
>
>3. **系统自我修复和诊断工具的失灵**
>* 像 `sfc /scannow` (系统文件检查器) 这样的工具，是用来扫描和修复系统文件完整性的。在遇到这种“目录联接”时，它们可能会被搞糊涂，无法正确验证文件，甚至可能做出错误的修复，加剧系统的不稳定。
>
>4. **操作过程本身的高风险**
>* 这个操作需要在Windows恢复环境（WinRE）的命令行里执行，全程手动敲命令。只要其中任何一个命令（`robocopy`, `rmdir`, `mklink`）输错一个参数，或者中间被打断，都可能导致系统无法启动。
>
>**结论**：这篇文章提供的方法，是一个典型的“看似可行，实则后患无穷”的方案。它可能在短期内解决了你的C盘空间问题，但却给系统埋下了一颗不稳定的种子，随时可能在未来的某次更新或软件安装中“引爆”。

所以最终我放弃了这个方法，毕竟Gemini都说了风险很大。
## 磁盘管理重新划分盘大小
最后我选择了重新划分一下盘之间的相对大小关系，把F盘的286个G全部分给C盘，将F盘分离开，放另外的地方去就可以了。尽管这个操作很简单，但是我的C盘和F盘之间隔着一个恢复分区，导致我的C盘没有办法接收F盘的空间，所以没有办法只能选择尝试将恢复分区先挪开，让C盘和F盘相邻。当然，这一步我也问了Gemini风险如何，Gemini回复如下：（这里说的视频就是本文后面的视频）
>这是一个含金量极高的问题！您找到的这个视频，可以说，已经触及到了这个问题的**“Pro-Level”（专业级）**解决方案的核心。
>
>我完整地观看了您分享的Bilibili视频。现在，作为一名资深的软件工程师，我为您进行一次“代码审查”（Code Review），剖析这个方法的技术原理、风险，以及它与第三方软件的对比。
>
>### 这个视频方法的本质是什么？
>
>首先，我必须肯定地说：**视频中的方法是完全正确、专业且技术上完全可行的。** 它不是什么“野路子”，而是系统管理员和高级用户手动管理Windows恢复环境的标准流程。
>
>它的核心逻辑如下：
>
>1. **解除绑定 (`reagentc /disable`)**：先通知系统：“我准备要动你的‘救生艇’（恢复分区）了，你先暂时别依赖它。” 这样就解锁了恢复分区里的核心文件`Winre.wim`。
>2. **备份核心 (`copy Winre.wim`)**：将“救生艇”里最重要的“急救包”——`Winre.wim`文件，复制到一个安全的地方（比如C盘）。
>3. **物理拆除 (`diskpart delete partition`)**：使用`diskpart`这个最底层的磁盘管理工具，强行删除旧的恢复分区。
>4. **扩建主船体 (`diskpart extend`)**：将释放出的空间扩展给C盘，完成核心目标。
>5. **重建新船坞 (`diskpart create partition`)**：在硬盘末尾，重新创建一个大小合适的新分区，作为新的“救生艇停泊位”。
>6. **打上特殊标记 (`set id` & `gpt attributes`)**：这是**最关键、最精髓、也最容易出错的一步**。通过`diskpart`命令，给这个新分区打上一个特殊的GUID（全局唯一标识符），告诉Windows：“嘿，这个分区不是普通的D盘、E盘，它是一个恢复分区！” 同时设置特殊属性，让它被系统隐藏和保护。
>7. **归还核心 (`copy Winre.wim`)**：把之前备份的“急救包”`Winre.wim`放回这个新的“停泊位”。
>8. **重新登记 (`reagentc /setreimage` & `/enable`)**：最后，再次通知系统：“新的‘救生艇’已经就位，地址在这里，请你重新记录并激活它。”
>
>**简单来说，您没有“移动”恢复分区，而是“拆解、重建、再注册”了一个新的恢复分区。**
>
>---
>
>### “手动挡” vs “自动挡”：风险在哪里？
>
>现在，我们来对比一下视频里的“手动操作”和使用第三方软件的“自动操作”。您可以把这理解为开**手动挡赛车**和开**自动挡家用车**的区别。
>
>**视频里的手动方法（手动挡赛车）：**
>
>* **优点**：
>* **无第三方软件**：全程使用Windows自带工具，干净、纯粹，没有安装任何额外软件的顾虑。
>* **掌控感强**：您能精确控制每一个步骤，对于专业人士来说，这是一种享受。
>* **巨大风险（开赛车的风险）**：
>1. **命令的无情**：`diskpart`和`reagentc`都是命令行工具。您只要**输错一个字母、一个数字、一个空格**，或者选错了磁盘号/分区号，后果可能是灾难性的。比如，误删了C盘分区，整个系统就直接报废了。**这里没有“撤销”按钮。**
>2. **“魔法数字”的诅咒**：视频中最关键的命令 `set id="de94bba4-06d1-4d40-a16a-bfd50179d6ac"`。这个长长的字符串是Windows恢复分区的“身份证号”。如果您不理解它的含义，只是照着抄，一旦抄错，新分区就无法被系统正确识别为恢复分区。
>3. **GPT属性的复杂性**：另一个关键命令 `gpt attributes=0x8000000000000001`，这个16进制数是用来设置分区属性（例如“系统必需”、“不自动分配盘符”）的，同样非常抽象，不容出错。
>4. **过程的不可中断性**：操作过程一旦开始，特别是删除和创建分区后，如果中途因为任何原因（断电、蓝屏、自己搞混了）而中断，您可能会留下一个分区表混乱、无法启动的系统。
>5. **认知负担**：您需要全神贯注，精确理解每一步的含义，不能有任何偏差。
>
>**第三方软件（自动挡家用车）：**
>
>* **优点**：
>* **图形化界面，直观安全**：您只需要拖动滑块，点击“移动”、“扩展”，所有复杂的操作都在一个安全、可视化的环境中进行。
>* **自动化后台处理**：您点击“应用”后，软件会**自动、精确地**完成我们上面提到的所有8个步骤（解除绑定、复制文件、删除、扩展、创建、打标记、归还、重新登记）。它内置了对各种“魔法数字”和复杂命令的正确调用。
>* **风险极低**：因为所有危险的命令都被软件封装好了，用户出错的可能性被降到了最低。它就像一辆有各种安全气囊和辅助驾驶的家用车。
>* **缺点**：
>* **需要安装第三方软件**：这是它唯一的“缺点”。但只要您从官网下载信誉良好的软件，这个缺点几乎可以忽略不计。
>
>---
>
>### 我的专业建议
>
>这就好比您心脏旁边长了一个小肿瘤（恢复分区），挡住了血管（C盘扩展）。
>
>* **视频里的方法**：相当于您亲自拿起手术刀，参考着医学教科书，给自己做一场心脏搭桥手术。您需要精确地避开每一根神经和血管，切除、重建、再缝合。对手术医生来说，这是日常。对普通人来说，这是九死一生。
>* **第三方软件的方法**：相当于您走进医院，一位经验丰富的外科医生，使用一台高度精密的自动化手术机器人，几分钟就帮您完成了手术，安全、无痛、高效。
>
>**所以，我的最终建议是：**
>
>1. **对于99.9%的用户，包括绝大多数IT从业者**：**请果断使用第三方分区软件。**
   这是最安全、最高效、最符合现代工程学“用合适的工具解决问题”思想的做法。您花费数小时去研究和执行一个高风险的手动操作，其潜在的时间成本和失败风险，远远超过了“避免安装一个软件”所带来的微不足道的心理安慰。
>
>2. **对于极少数的“硬核玩家”**：如果您满足以下**所有条件**，可以挑战一下视频里的方法：
>* 您对`diskpart`命令了如指掌，闭着眼睛都能操作。
>* 您完全理解GPT分区表、GUID、分区属性等底层概念。
>* 您享受在命令行里解决问题的过程，并愿意为可能发生的失误承担后果。
>* **您已经创建了完整的系统镜像备份和可启动的U盘，做好了系统崩溃后从零开始重装所有东西的准备。**
>
>**结论**：您找到的视频是一个非常棒的学习资料，它让我们得以一窥Windows系统管理的底层逻辑。**但作为解决问题的方案，它对于非专业系统管理员来说，风险和收益完全不成正比。**
>
>请选择“自动挡”，把专业的事交给专业的工具。这才是最明智、最有效率的工程师思维。

当然，我这么倔强的人，肯定选择了很蠢的手动操作（因为不想下载软件），此外还建议使用映像备份，那样即使后面出问题也是可以恢复的（甚至包括你的分区状态都可以恢复），也可以使用第三方的备份软件进行备份。是的，没错，我也没有备份，只是普通地备份了一下我的F盘的数据（和没备份区别不大），就开始操作了。具体操作过程没什么特别的，就是视频里的操作过程，完全一样，没什么好说的，这里我就贴一下视频就好了，多的也不用怎么说，不过建议先看完下面两个视频再操作，避免所有可能的问题。<br>
{%include embed/bilibili.html aid=382276865%}
操作结束可能遇到一个显示bug（我遇到了），同样的up主也有解决办法，就是下面这个视频，不过好像评论区有更好的办法，不过我没有尝试，我是操作完才看到评论区的这个办法的。<br>
{%include embed/bilibili.html aid=622834418%}
