---
title: MC模组服务端代码测试
author: me
date: 2025-05-24 14:37:00 +0800
description: 在MC模组开发过程中，很多时候我们都需要测试代码能否在服务器上运行，而Forge等开发平台也都提供了这样的工具，本文便就是介绍如何使用这些工具测试我们的模组能不能在服务端加载
categories: [MC,模组开发]
tags: [MC,Forge,模组开发,代码]
---
## 起因
在开发我的第一个模组（也是第一个编程项目）[SmarterContraptionStorage](https://www.mcmod.cn/class/15306.html)时，我的模组经常出现服务器无法加载的情况
![评论.png](/commons/posts/MC%E6%A8%A1%E7%BB%84%E6%B5%8B%E8%AF%95%E6%9C%8D%E5%8A%A1%E7%AB%AF/%E8%AF%84%E8%AE%BA.png)
而且一查代码都是很愚蠢的客户端代码写在服务端导致的错误，因此我才重视起来在服务端测试我的代码的事情。<br><br>
起初我以为服务端代码测试要求我先架设一台服务器，而我并不会架设服务器，所以我根本就没有测试代码能不能在服务端跑。不过在学习之后（首先学习的是Forge上如何测试）我发现并不需要那么麻烦，ForgeGradle已经提供了测试的Gradle Task，我只需要修改一些基本配置并运行，一台临时的服务器就开启起来了。下面我就将我的学习结果记录在下面，包含Forge和NeoForge上进行服务端代码测试的方法
## Forge
### 工具
Forge提供了两个和服务器有关的测试Task,分别是`runServer`和`runGameTestServer`，其中`runServer`可以持续地开启一个临时的服务器，还允许别人加入。而`runGameTestServer`功能相对更简单，更适合Github Action这种定时任务检查代码，其会开启一个服务器，并进入一个预先设置好的世界，成功之后便自动退出，并不允许其他玩家加入和细节测试。所以我们主要针对的就是`runServer`任务。
### 更改配置
但是要注意的是你如果直接允许这个任务而不修改任何配置是会无法进入服务器的，它会直接退出，而且还会返回`SUCCESS`让你以为执行其实成功了，但是实际上没有打开服务器。这主要是因为你没有同意`run/eula.txt`{: .filepath}里的Minecraft 的终端用户许可协议（EULA），所以按照设计自己立即退出了，而Gradle以为执行成功，返回`SUCCESS`误导你以为没问题。你只需要进入`run/eula.txt`{: .filepath}将`eula=false`改为`eula=true`然后再次允许命令就可以打开服务器了。<br><br>
但是就算你打开了服务器，你此时也进不去游戏，以为服务器的一些基本设置我们还没有更改，这些条目和开服务器时遇到的条目是一样的，所以同样地更改就可以了，在我测试的过程中我总结的以下的条目最需要更改<br><br>
最需要更改的是服务器设置，文件是`run/server.properties`{: .filepath}，其中我们需要更改连接的玩家的限制，允许离线账号登录，否则`runClient`启动的游戏是无法登录进服务器的。具体地是`online-mode`条我们需要设置为`true`，设置之后我们就可以加入服务器了。<br><br>
其次我们还需要给自己op权限以使用命令，对应的文件是`run/ops.json`{: .filepath}，我们需要将我们自己的玩家加进文件中，比如：
```json
[
  {
    "name":"Dev",
    "uuid":"380df991-f603-344c-a090-369bad2a924a",
    "level": 4,
    "bypassesPlayerLimit": true
  }
]
```
其中`name`是玩家名字，`uuid`则是玩家对应的UUID，这两个需要相互对应，获取其最简单的方法就是先用`runClient`启动的游戏登录一次临时的服务器，然后在`run/usercache.json`{: .filepath}中就能找到对应的登录过的玩家的信息（正常情况下你更改登录过的那一个记录），将数据复制过去即可。后面的`level`是玩家的op权限等级，最高是4，所以写4即可，第四个`bypassesPlayerLimit`是是否允许管理员无视服务器人数上限加入游戏，`true`表示无视，这个对我们无关紧要，随便写就可以。<br><br>
### 加入游戏
在所有这些配置之后，我们就可以让Idea同时运行`runServer`和`runClient`命令，开启临时服务器和一个客户端，然后在客户端中正常按多人游戏联机就可以加入我们临时的服务器了，其中网址填`localhost:25565`，因为Minecraft服务器默认启动在25565端口上，如果更改了端口会导致网址的改变，这个就看你具体设置的那个端口了。
### 其他
还有一些其他的点我没有提到或者我没有找到，那就是我并没有找到`runServer`开启的临时服务器的控制台，从而没有办法使用控制台命令，对此我不清楚到底是没有控制台还是我没有找到，还请知道的大佬评论区补充🙏。
## NeoForge
对于NeoForge，其与Forge几乎相同，因为他们毕竟是同根生的，仍然是`runServer`和`runGameTestServer`这两个选项，设置也几乎完全一样，文件`run/server.properties`{: .filepath}和`run/ops.json`{: .filepath}都是一样的，修改也完全一样。但是也有不一样的地方，比如NeoForge没有`run/eula.txt`{: .filepath}文件，这可以说是非常好了，这样就不存在误以为运行成功了的情况了；而且即使不更改`run/server.properties`{: .filepath}文件，在`runClient`开启的游戏中，我们仍然可以进得去服务器。
### 其他
值得说道的是NeoForge服务器和客户端启动都比Forge更快，不愧是优化过的。👍